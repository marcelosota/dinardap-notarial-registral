<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:b="http://bootsfaces.net/ui" xmlns:p="http://primefaces.org/ui">

<ui:composition template="/template/general.xhtml">
	<ui:define name="content">
		<h1 class="h-wai">#{etiquetas['nombre.sistema']} - Trámites
			Pendientes Registrador</h1>		

		<h:form id="formRegistradorDtb">
			<p:remoteCommand name="actualizarTabla"
				action="#{tramitesPendientesRegistrosCtrl.refrescarDtb}"
				update="formRegistradorDtb:dtbPendientes" />
			<p:dataTable id="dtbPendientes" var="dtb" widgetVar="wm"
				value="#{tramitesPendientesRegistrosCtrl.listaTramitePendiente}"
				rows="7" paginator="true" paginatorPosition="bottom"
				selectionMode="single" rowKey="#{dtb.codigo}"
				selection="#{tramitesPendientesRegistrosCtrl.selectedTramite}"
				paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink}"
				emptyMessage="No existen registros"
				filteredValue="#{tramitesPendientesRegistrosCtrl.filtro}">
				<p:ajax event="rowSelect"
					listener="#{tramitesPendientesRegistrosCtrl.filaSeleccionada}"
					update="formulario" />
				<p:column headerText="#{etiquetas['codigo.tramite']}" width="105"
					filterBy="#{dtb.codigo}" sortBy="#{dtb.codigo}"
					filterMatchMode="contains">
					<h:outputText value="#{dtb.codigo}" />
				</p:column>
				<p:column headerText="#{etiquetas['nombre.institucion']}"
					width="160">
					<h:outputText value="#{dtb.institucion}"
						styleClass="texto-justificado" />
				</p:column>
				<p:column
					headerText="#{etiquetas['nombre.descripcionActoNotarial']}"
					width="160">
					<h:outputText value="#{dtb.descripcionNotarial}"
						styleClass="texto-justificado" />
				</p:column>
				<p:column headerText="#{etiquetas['registrado.por']}" width="100">
					<h:outputText value="#{dtb.registradoPor}"
						styleClass="texto-justificado" />
				</p:column>
				<p:column headerText="#{etiquetas['fecha.registro']}" width="100">
					<h:outputText value="#{dtb.fechaRegistro}"
						styleClass="texto-justificado">
						<f:convertDateTime pattern="yyyy-MM-dd" />
					</h:outputText>
				</p:column>
			</p:dataTable>
		</h:form>
		<h:form id="formulario">
			<p:panel style="width: 95%" header="#{etiquetas['detalle.tramite']}">
				<h:panelGrid columns="3" style="width: 50%"
					columnClasses="form-label-derecha ui-grid-col-1, form-input-izquierda,form-input-izquierda">
					<p:outputLabel id="codigoTramite" for="codigo"
						value="#{etiquetas['codigo.tramite']}" />
					<p:inputText id="codigo"
						value="#{tramitesPendientesRegistrosCtrl.ctvu}" 
						required="true"
						requiredMessage="#{etiquetas['codigo.tramite']} #{mensajes['requerido']}"/>
					<p:commandButton value="#{etiquetas['buscar']}" 
						update="codigo, identificacion, requirente, correo, 
						somEstadoTramite, observacionInconsistente, observacionCerrado, fupDocumentoRegistral"
						actionListener="#{tramitesPendientesRegistrosCtrl.consultarPorCvtu}"
						icon="ui-icon-search" process="@this, codigo" />
				</h:panelGrid>
				<p:separator />
				<h:panelGrid columns="2"
					columnClasses="form-label-derecha ui-grid-col-1, form-input-izquierda">
					<p:outputLabel for="identificacion"
						value="#{etiquetas['identificacion']}" />
					<p:inputText id="identificacion"
						value="#{tramitesPendientesRegistrosCtrl.tramiteDto.tramite.identificacionRequirente}"
						size="64" readonly="true">
					</p:inputText>
					<p:outputLabel for="requirente"
						value="#{etiquetas['nombre.requirente']}" />
					<p:inputText id="requirente"
						value="#{tramitesPendientesRegistrosCtrl.tramiteDto.tramite.nombreRequirente}"
						size="64" readonly="true">
					</p:inputText>
					<p:outputLabel for="correo"
						value="#{etiquetas['correo.electronico']}" />
					<p:inputText id="correo"
						value="#{tramitesPendientesRegistrosCtrl.tramiteDto.tramite.correoRequirente}"
						size="64" readonly="true">
					</p:inputText>
					<p:outputLabel for="btnDescargaActoNotarial"
						value="#{etiquetas['acto.notarial']}" />
					<h:commandLink id="btnDescargaActoNotarial" target="_blank"
						value="Descargar" immediate="true"
						action="#{tramitesPendientesRegistrosCtrl.descargarActoNotarial}">
						<i class="fa fa-file-pdf-o fa-lg actoNotarial"></i>
					</h:commandLink>
				</h:panelGrid>
			</p:panel>
			<p:panel header="#{etiquetas['seccion.registros']}"
				style="margin-bottom:20px;width: 95%">
				<h:panelGrid columns="2"
					columnClasses="form-label-derecha ui-grid-col-1, form-input-izquierda">
					<h:outputText value="#{etiquetas['estado.tramite']}*" />
					<p:selectOneMenu id="somEstadoTramite" disabled=""
						value="#{tramitesPendientesRegistrosCtrl.estadoTramite}"
						required="true"
						requiredMessage="#{etiquetas['estado.tramite']} #{mensajes['requerido']}">
						<p:ajax event="change"
							listener="#{tramitesPendientesRegistrosCtrl.cambiarEstadoTramite}"
							update="@form observacionInconsistente observacionCerrado fupDocumentoRegistral oplDocumento" />
						<f:selectItem itemLabel="Seleccionar .." itemValue="#{null}" />
						<f:selectItem itemLabel="INCONSISTENTE" itemValue="4" />
						<f:selectItem itemLabel="ATENDIDO" itemValue="5" />
					</p:selectOneMenu>
					<h:outputText
						rendered="#{!tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						value="#{etiquetas['observacion']}*" />
					<p:inputTextarea id="observacionInconsistente"
						rendered="#{!tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						disabled="" rows="4" cols="60" autoResize="true"
						value="#{tramitesPendientesRegistrosCtrl.tramiteDto.observacionRegistro}"
						maxlength="512" required="true"
						requiredMessage="Observación : #{mensajes['requerido']}" />
					<h:outputText
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						value="#{etiquetas['observacion']}" />
					<p:inputTextarea id="observacionCerrado"
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						disabled="" rows="4" cols="60" autoResize="true"
						value="#{tramitesPendientesRegistrosCtrl.tramiteDto.observacionRegistro}"
						maxlength="512" />
					<h:outputText id="oplDocumento"
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						value="#{etiquetas['cargar.documento.registral']}*" />
					<p:fileUpload id="fupDocumentoRegistral"
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						style="width:40%" label="#{etiquetas['seleccionar']}"
						fileUploadListener="#{tramitesPendientesRegistrosCtrl.subirArchivo}"
						sizeLimit="20971520" process="@this" allowTypes="/(\.|\/)(pdf)$/"
						mode="advanced" auto="true" required="true" update="" />
					<h:outputText id="oplRegistral"
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						value="#{etiquetas['visualizar.documento.registral']}*" />
					<h:commandLink id="btnDescargaRegistral" target="_blank"
						rendered="#{tramitesPendientesRegistrosCtrl.estadoInconsistente}"
						value="Descargar" immediate="true"
						action="#{tramitesPendientesRegistrosCtrl.descargarRegistro()}">
						<i class="fa fa-file-pdf-o fa-lg documentoRegistral"></i>
					</h:commandLink>
				</h:panelGrid>
				<br />
				<br />
				<h:panelGrid columns="2"
					style="width: 50%; margin: 4px 5px; text-align: center;">
					<p:commandButton value="#{etiquetas['guardar']}" id="guardarBtn"
						style="margin-right:20px;"
						icon="ui-icon-disk" 
						update="formulario, formRegistradorDtb" 
						action="#{tramitesPendientesRegistrosCtrl.guardarTramite}" 
						oncomplete="PF('wm').clearFilters(); :formRegistradorDtb:actualizarTabla();" />
					<p:commandButton value="#{etiquetas['cancelar']}" id="cancelarBtn"
						style="margin-right:20px;" icon="fa fa-fw fa-ban" update="formulario"
						action="#{tramitesPendientesRegistrosCtrl.cancelar}" />					
				</h:panelGrid>
			</p:panel>


		</h:form>
	</ui:define>
</ui:composition>
</html>